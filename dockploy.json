{
  "$schema": "https://dockploy.com/schemas/config.json",
  "version": "1.0",
  "name": "tappplus",
  "description": "Application web de rappels d'interventions m√©dicales - Gestion compl√®te des rappels patients pour m√©decins",

  "source": {
    "type": "github",
    "repository": "https://github.com/YOUR_USERNAME/tappplus",
    "branch": "main",
    "autoDeploy": true,
    "buildContext": "."
  },

  "build": {
    "type": "dockerfile",
    "dockerfile": "Dockerfile",
    "args": {},
    "cache": true,
    "noCache": false
  },

  "deployment": {
    "replicas": 1,
    "strategy": "rolling",
    "restartPolicy": "unless-stopped",

    "ports": [
      {
        "containerPort": 80,
        "hostPort": 80,
        "protocol": "tcp",
        "public": true
      }
    ],

    "env": {
      "NODE_ENV": {
        "value": "production",
        "required": true
      },
      "DATABASE_URL": {
        "value": "file:/app/data/meditache.db",
        "required": true,
        "description": "Path to SQLite database file (persistent volume)"
      },
      "REDIS_URL": {
        "value": "redis://127.0.0.1:6379",
        "required": true,
        "description": "Redis URL for background jobs (internal to container)"
      },
      "JWT_SECRET": {
        "value": "",
        "required": true,
        "secret": true,
        "description": "JWT secret for access tokens - MUST BE CHANGED! Generate with: openssl rand -base64 32"
      },
      "JWT_REFRESH_SECRET": {
        "value": "",
        "required": true,
        "secret": true,
        "description": "JWT secret for refresh tokens - MUST BE CHANGED! Generate with: openssl rand -base64 32"
      },
      "TZ": {
        "value": "Africa/Douala",
        "required": false,
        "description": "Server timezone for scheduled tasks and logs"
      },
      "API_PORT": {
        "value": "5550",
        "required": true,
        "description": "Internal API port (DO NOT CHANGE unless you modify nginx config)"
      },
      "WEB_PORT": {
        "value": "5500",
        "required": true,
        "description": "Internal web frontend port (DO NOT CHANGE unless you modify nginx config)"
      },
      "HTTP_PORT": {
        "value": "80",
        "required": false,
        "description": "External HTTP port exposed by the container"
      },
      "NEXT_PUBLIC_API_URL": {
        "value": "",
        "required": false,
        "description": "Public API URL - Leave empty for auto-detection via reverse proxy"
      }
    },

    "volumes": [
      {
        "name": "tappplus-data",
        "mountPath": "/app/data",
        "type": "persistent",
        "size": "5GB",
        "description": "SQLite database storage - CRITICAL: Do not delete!"
      },
      {
        "name": "tappplus-logs",
        "mountPath": "/app/logs",
        "type": "persistent",
        "size": "2GB",
        "description": "PM2 and Nginx logs storage"
      }
    ],

    "healthCheck": {
      "type": "http",
      "path": "/health",
      "port": 80,
      "method": "GET",
      "interval": 30,
      "timeout": 10,
      "retries": 3,
      "startPeriod": 60,
      "expectedStatus": 200
    },

    "resources": {
      "limits": {
        "memory": "1024M",
        "cpu": "1.0"
      },
      "reservations": {
        "memory": "512M",
        "cpu": "0.5"
      }
    }
  },

  "networking": {
    "domains": [],
    "ssl": {
      "enabled": false,
      "provider": "letsencrypt",
      "autoRenew": true
    },
    "redirectHttpToHttps": true
  },

  "backups": {
    "enabled": false,
    "schedule": "0 2 * * *",
    "retention": 7,
    "paths": [
      "/app/data"
    ],
    "destinations": []
  },

  "monitoring": {
    "enabled": true,
    "metrics": {
      "cpu": true,
      "memory": true,
      "network": true,
      "disk": true
    },
    "alerts": {
      "enabled": false,
      "channels": []
    }
  },

  "hooks": {
    "postDeploy": [
      {
        "name": "Initialize Database",
        "command": "node scripts/init-db.js",
        "runOnce": true,
        "continueOnError": false
      }
    ]
  },

  "metadata": {
    "author": "TappPlus Team",
    "version": "1.0.0",
    "documentation": "https://github.com/YOUR_USERNAME/tappplus/blob/main/DOCKPLOY.md",
    "tags": ["medical", "reminders", "nestjs", "nextjs", "sqlite", "redis"],
    "icon": "üè•"
  },

  "notes": {
    "setup": [
      "1. Clone this repository to your Dockploy instance",
      "2. Configure JWT_SECRET and JWT_REFRESH_SECRET (use: openssl rand -base64 32)",
      "3. Deploy the application",
      "4. The database will be initialized automatically with the postDeploy hook",
      "5. Access the app at http://YOUR_SERVER_IP or configure a custom domain"
    ],
    "requirements": [
      "Minimum 2 GB RAM",
      "Minimum 10 GB storage",
      "Docker 20.10+",
      "Port 80 available (or configure different port)"
    ],
    "architecture": [
      "Single container deployment (all-in-one)",
      "Nginx reverse proxy (port 80)",
      "NestJS API (internal port 5550)",
      "Next.js Frontend (internal port 5500)",
      "Redis for job queue (internal port 6379)",
      "SQLite database (persistent volume)",
      "PM2 process manager (5 processes)"
    ],
    "processes": [
      "nginx - Reverse proxy and static files",
      "redis - Background job queue",
      "api - NestJS backend API",
      "web - Next.js frontend",
      "worker - Background jobs processor"
    ]
  }
}
